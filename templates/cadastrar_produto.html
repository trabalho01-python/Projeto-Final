{% extends 'base.html' %}

{% block conteudo %}

<div class="container mt-5">
    <h2 class="mb-4 text-4">Cadastrar Produto</h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <form method="post" action="{{url_for('cadastrar_produto')}}" class="formulario-2">
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="nome" class="form-label title-color2">Nome:</label>
                <input type="text" class="form-control color-border1" id="nome" name="nome" required>
            </div>

            <div class="col-md-6">
                <label for="descricao" class="form-label title-color2">Descricao:</label>
                <input type="text" class="form-control color-border1" id="descricao" name="descricao" required>
            </div>

            <div class="col-md-6">
                <label for="categoria" class="form-label title-color2">Categoria</label>
                <select class="form-select color-border1" id="categoria" name="categoria" required>
                    <option value="">Selecione</option>
                    <option value="alimentos">Alimentos</option>
                    <option value="bebidas">Bebidas</option>
                    <option value="higiene">Higiene</option>
                    <option value="limpeza">Limpeza</option>
                    <option value="hortifruti">Hortifruti</option>
                    <option value="padaria">Padaria</option>
                </select>
            </div>

            <div class="col-md-6">
                <div class="mb-3 campo">
                    <label for="preco" class="form-label title-color2">Preço</label>
                    <div class="input-preco">
                        <span class="prefixo">R$</span>
                        <input class="color-border1" type="text" id="preco" name="preco" required>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="campo">
                    <label for="validade" class="title-color2">Data de Validade</label>
                    <input class="color-border1" type="date" id="validade">
                    <div class="checkbox">
                        <input type="checkbox" id="sem_validade">
                        <label for="sem_validade">Sem validade</label>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="mb-3 campo linha-checkbox">
                    <label for="estoque" class="form-label title-color2">Estoque</label>
                    <input type="number" class="form-control" id="estoque" name="estoque" required>
                </div>
            </div>

            <div class="col-md-6">
                <div class="mb-3 campo">
                    <label for="imagem" class="form-label title-color2">Foto do Produto</label>
                    <input type="text" class="form-control" id="imagem" name="imagem" accept="image/*" required>
                </div>
            </div>

            <div class="col-md-6">
                <div class="botao">
                    <button type="submit" class="btn btn-primary">Cadastrar</button>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
    document.getElementById('preco').addEventListener('input', function (e) {
        let input = e.target;
        let value = input.value.replace(/\D/g, ''); // remove tudo que não for número

        if (value.length === 0) {
            input.value = '';
            return;
        }

        value = (parseInt(value, 10) / 100).toFixed(2); // divide por 100 e fixa 2 casas
        value = value.replace('.', ','); // troca ponto por vírgula
        value = value.replace(/\B(?=(\d{3})+(?!\d))/g, '.'); // adiciona pontos nos milhares

        input.value = value;
    });
</script>

<script>
    document.getElementById('sem_validade').addEventListener('change', function () {
        const validadeInput = document.getElementById('data_validade');
        if (this.checked) {
            validadeInput.disabled = true;
            validadeInput.value = '';
        } else {
            validadeInput.disabled = false;
        }
    });
</script>

{% endblock %}